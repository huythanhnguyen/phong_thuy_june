<template>
  <div class="min-h-screen flex flex-col">

    <!-- Header -->
    <Header />

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 flex-grow max-w-4xl">
      <!-- Breadcrumb -->
      <div class="flex items-center text-sm text-gray-500 mb-6">
        <router-link to="/" class="hover:text-primary">Trang ch·ªß</router-link>
        <span class="mx-2">/</span>
        <span class="text-gray-700">CƒÉn C∆∞·ªõc C√¥ng D√¢n</span>
      </div>
      
      <h1 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">√ù Nghƒ©a CƒÉn C∆∞·ªõc C√¥ng D√¢n</h1>          
      
      <!-- Content -->
      <div class="prose prose-lg max-w-none">
        <p class="lead text-xl text-gray-600 mb-8">
          CƒÉn c∆∞·ªõc c√¥ng d√¢n (CCCD) kh√¥ng ch·ªâ l√† gi·∫•y t·ªù t√πy th√¢n m√† c√≤n ·∫©n ch·ª©a nh·ªØng √Ω nghƒ©a phong th·ªßy 
          quan tr·ªçng th√¥ng qua c√°c d√£y s·ªë tr√™n th·∫ª.
        </p>

        <div class="mb-8 bg-blue-50 p-6 rounded-lg border border-blue-200">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">C·∫•u tr√∫c s·ªë CƒÉn c∆∞·ªõc c√¥ng d√¢n</h2>
          <p class="mb-4">Theo Th√¥ng t∆∞ 07/2016/TT-BCA, m·ªói s·ªë tr√™n th·∫ª cƒÉn c∆∞·ªõc c√¥ng d√¢n ƒë·ªÅu mang m·ªôt √Ω nghƒ©a nh·∫•t ƒë·ªãnh:</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-lg mb-2 flex items-center">
                <span class="flex items-center justify-center w-8 h-8 bg-primary text-white rounded-full text-sm mr-2">1</span>
                Ba ch·ªØ s·ªë ƒë·∫ßu ti√™n
              </h3>
              <p>L√† m√£ t·ªânh, th√†nh ph·ªë tr·ª±c thu·ªôc trung ∆∞∆°ng ho·∫∑c m√£ qu·ªëc gia n∆°i c√¥ng d√¢n ƒëƒÉng k√Ω khai sinh.</p>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-lg mb-2 flex items-center">
                <span class="flex items-center justify-center w-8 h-8 bg-primary text-white rounded-full text-sm mr-2">2</span>
                M·ªôt ch·ªØ s·ªë ti·∫øp theo
              </h3>
              <p>L√† m√£ gi·ªõi t√≠nh c·ªßa c√¥ng d√¢n.</p>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-lg mb-2 flex items-center">
                <span class="flex items-center justify-center w-8 h-8 bg-primary text-white rounded-full text-sm mr-2">3</span>
                Hai ch·ªØ s·ªë ti·∫øp theo
              </h3>
              <p>L√† m√£ nƒÉm sinh c·ªßa c√¥ng d√¢n.</p>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-lg mb-2 flex items-center">
                <span class="flex items-center justify-center w-8 h-8 bg-primary text-white rounded-full text-sm mr-2">4</span>
                S√°u ch·ªØ s·ªë cu·ªëi
              </h3>
              <p>L√† d√£y s·ªë ng·∫´u nhi√™n - ƒë√¢y l√† ph·∫ßn ch√∫ng ta s·∫Ω ph√¢n t√≠ch theo phong th·ªßy.</p>
            </div>
          </div>
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-4">Ph∆∞∆°ng ph√°p ph√¢n t√≠ch phong th·ªßy</h2>
        
        <p class="mb-4">
          Trong phong th·ªßy s·ªë h·ªçc, ch√∫ng ta ch·ªâ ph√¢n t√≠ch 6 s·ªë cu·ªëi c·ªßa cƒÉn c∆∞·ªõc c√¥ng d√¢n v√¨ ƒë√¢y l√† d√£y s·ªë 
          ng·∫´u nhi√™n v√† c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn v·∫≠n m·ªánh c·ªßa ng∆∞·ªùi s·ªü h·ªØu.
        </p>
        
        <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200 mb-8">
          <h3 class="font-semibold text-lg mb-3">Quy t·∫Øc ph√¢n t√≠ch:</h3>
          <ol class="list-decimal list-inside space-y-3">
            <li>Ch·ªâ ph√¢n t√≠ch 6 ch·ªØ s·ªë cu·ªëi c·ªßa cƒÉn c∆∞·ªõc c√¥ng d√¢n.</li>
            <li>N·∫øu g·∫∑p s·ªë 0, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng s·ªë k·∫ø tr∆∞·ªõc b√™n tay tr√°i.</li>
            <li>N·∫øu s·ªë k·∫ø tr∆∞·ªõc c≈©ng l√† 0, ti·∫øp t·ª•c ti·∫øn v·ªÅ b√™n tr√°i cho ƒë·∫øn khi g·∫∑p s·ªë kh√°c 0.</li>
            <li>Sau khi c√≥ d√£y s·ªë ƒë√£ ƒë∆∞·ª£c chu·∫©n h√≥a, ch√∫ng ta ph√¢n t√≠ch th√†nh t·ª´ng c·∫∑p s·ªë ƒë·ªÉ x√°c ƒë·ªãnh c√°c c·∫∑p sao.</li>
            <li>M·ªói c·∫∑p sao s·∫Ω ƒë∆∞·ª£c ƒë√°nh gi√° l√† c√°t (t·ªët) hay hung (x·∫•u) d·ª±a tr√™n nguy√™n l√Ω B√°t C·ª±c Linh S·ªë.</li>
          </ol>
        </div>
        
        <div class="bg-green-50 p-6 rounded-lg border border-green-200 mb-8">
          <h3 class="font-semibold text-lg mb-3">V√≠ d·ª• minh h·ªça:</h3>
          <p class="mb-2">Gi·∫£ s·ª≠ 6 s·ªë cu·ªëi c·ªßa CCCD l√†: <strong>120304</strong></p>
          <ul class="list-disc list-inside space-y-2 mb-4">
            <li>C√°c c·∫∑p s·ªë: <strong>12</strong>, <strong>03</strong>, <strong>04</strong></li>
            <li>V·ªõi c·∫∑p <strong>03</strong>: G·∫∑p s·ªë 0 n√™n thay b·∫±ng s·ªë k·∫ø tr∆∞·ªõc (3), th√†nh <strong>33</strong></li>
            <li>V·ªõi c·∫∑p <strong>04</strong>: G·∫∑p s·ªë 0 n√™n thay b·∫±ng s·ªë k·∫ø tr∆∞·ªõc (4), th√†nh <strong>44</strong></li>
            <li>D√£y s·ªë sau chu·∫©n h√≥a: <strong>12</strong>, <strong>33</strong>, <strong>44</strong></li>
          </ul>
          <p>T·ª´ ƒë√¢y, ch√∫ng ta s·∫Ω ph√¢n t√≠ch √Ω nghƒ©a phong th·ªßy c·ªßa c√°c c·∫∑p s·ªë n√†y t∆∞∆°ng t·ª± nh∆∞ ph√¢n t√≠ch s·ªë ƒëi·ªán tho·∫°i.</p>
        </div>
        
        <p class="mb-6">
          Vi·ªác ph√¢n t√≠ch s·ªë CCCD theo phong th·ªßy c√≥ th·ªÉ gi√∫p b·∫°n hi·ªÉu th√™m v·ªÅ c√°c y·∫øu t·ªë t√°c ƒë·ªông ƒë·∫øn v·∫≠n m·ªánh 
          v√† ·∫£nh h∆∞·ªüng ti·ªÅm ·∫©n c·ªßa d√£y s·ªë n√†y ƒë·∫øn c√°c kh√≠a c·∫°nh kh√°c nhau trong cu·ªôc s·ªëng nh∆∞ s·ª± nghi·ªáp, 
          t√†i l·ªôc, s·ª©c kh·ªèe hay c√°c m·ªëi quan h·ªá.
        </p>
        
        <p>
          Tuy nhi√™n, c·∫ßn l∆∞u √Ω r·∫±ng ph∆∞∆°ng ph√°p n√†y ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o, d·ª±a tr√™n nguy√™n l√Ω phong th·ªßy c·ªï 
          truy·ªÅn k·∫øt h·ª£p v·ªõi c√°c ph∆∞∆°ng ph√°p hi·ªán ƒë·∫°i.
        </p>
      </div>

      <!-- Analysis Input Section - MOVED TO BOTTOM -->
      <div class="mt-12 mb-8 bg-gray-50 p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Ph√¢n T√≠ch S·ªë CCCD C·ªßa B·∫°n</h2>
        
        <!-- CCCD Input -->
        <div class="mb-4">
          <label for="cccd" class="block text-gray-700 text-sm font-bold mb-2">Nh·∫≠p s·ªë CƒÉn C∆∞·ªõc C√¥ng D√¢n (12 s·ªë):</label>
          <input type="text" id="cccd" v-model="cccd" 
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="Nh·∫≠p 12 s·ªë CCCD" maxlength="12">
          <p v-if="cccdError" class="text-red-500 text-xs italic mt-1">{{ cccdError }}</p>
        </div>
      
        <!-- Analyze Button -->
        <div class="mb-4">
          <button @click="analyzeCCCD" :disabled="loading"
                  class="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-200">
            <span v-if="loading" class="flex items-center">
              <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              ƒêang ph√¢n t√≠ch...
            </span>
            <span v-else>Ph√¢n t√≠ch CCCD</span>
          </button>
        </div>
        
        <p class="text-sm text-gray-600">
          Nh·∫≠p 12 s·ªë trong th·∫ª CCCD c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n ph√¢n t√≠ch chi ti·∫øt theo ph∆∞∆°ng ph√°p B√°t C·ª±c Linh S·ªë.
          Ch√∫ng t√¥i ch·ªâ ph√¢n t√≠ch 6 s·ªë cu·ªëi c·ªßa CCCD v√† kh√¥ng l∆∞u tr·ªØ th√¥ng tin c√° nh√¢n c·ªßa b·∫°n.
        </p>
      </div>
      
      <!-- Analysis Result Section - ƒê·∫∂T B√äN D∆Ø·ªöI INPUT V·ªöI ID -->
      <div v-if="displayAnalysis" id="analysis-results" class="mb-12 bg-white p-6 rounded-lg shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">K·∫øt Qu·∫£ Ph√¢n T√≠ch CCCD</h2>
        
        <!-- Th√¥ng tin c∆° b·∫£n -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2 text-blue-800">S·ªë CCCD g·ªëc</h3>
            <p class="text-lg font-mono">{{ displayAnalysis.originalNumber }}</p>
          </div>
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2 text-blue-800">S√°u s·ªë cu·ªëi</h3>
            <p class="text-lg font-mono">{{ displayAnalysis.lastSixDigits }}</p>
          </div>
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2 text-blue-800">Chu·ªói chu·∫©n h√≥a</h3>
            <p class="text-lg font-mono">{{ displayAnalysis.normalizedSequence }}</p>
          </div>
        </div>
        
        <!-- ƒêi·ªÉm t·ªïng th·ªÉ -->
        <!-- ƒêi·ªÉm t·ªïng th·ªÉ -->

        
        <!-- Ph√¢n t√≠ch c√°c c·∫∑p s·ªë -->
        <div class="mb-8">
          <h3 class="text-xl font-bold mb-4 text-gray-800">Ph√¢n T√≠ch C√°c C·∫∑p S·ªë</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div v-for="pair in displayAnalysis.pairsAnalysis" :key="pair.pairNumber"
                 :class="[
                  'p-4 rounded-lg shadow-sm border-l-4',
                  pair.nature === 'C√°t' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'
                ]">
              <div class="flex justify-between items-center mb-2">
                <span class="text-lg font-bold font-mono">{{ pair.digits }}</span>
                <span :class="[
                  'px-2 py-1 rounded-full text-xs font-semibold',
                  pair.nature === 'C√°t' ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'
                ]">
                  {{ pair.nature }}
                </span>
              </div>
              <p class="mb-2"><span class="font-semibold">Sao:</span> {{ pair.star }}</p>
              <p class="mb-2 text-sm">{{ pair.meaning }}</p>
              <div v-if="pair.energyLevel" class="flex items-center">
                <span class="text-sm mr-2">NƒÉng l∆∞·ª£ng:</span>
                <div class="flex">
                  <div v-for="n in 4" :key="n" 
                        :class="[
                         'w-2 h-2 rounded-full mr-1',
                          n <= pair.energyLevel ? 
                           (pair.nature === 'C√°t' ? 'bg-green-500' : 'bg-red-500') : 
                            'bg-gray-200'
                        ]">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ƒê·∫∑c t√≠nh b·∫©m sinh -->
        <div v-if="displayAnalysis.characteristics" class="mb-8">
          <h3 class="text-xl font-bold mb-4 text-gray-800">ƒê·∫∑c T√≠nh B·∫©m Sinh</h3>
          <div class="space-y-4">
            <div v-for="(characteristic, index) in displayAnalysis.characteristics" :key="index" 
                 class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border-l-4 border-blue-400">
              <h4 class="font-semibold text-blue-800 mb-2">{{ characteristic.category }}</h4>
              <p class="text-gray-700 text-sm leading-relaxed">{{ characteristic.description }}</p>
            </div>
          </div>
        </div>
        
        <!-- Ghi ch√∫ h√≥a gi·∫£i -->
        <div v-if="displayAnalysis.remedyNotes" class="mb-8">
          <h3 class="text-xl font-bold mb-4 text-gray-800">Ghi Ch√∫ H√≥a Gi·∫£i</h3>
          <div class="space-y-4">
            <div v-for="(note, index) in displayAnalysis.remedyNotes" :key="index" 
                 :class="[
                   'p-4 rounded-lg border-l-4',
                   note.type === 'info' ? 'bg-blue-50 border-blue-400' :
                   note.type === 'warning' ? 'bg-yellow-50 border-yellow-400' :
                   note.type === 'remedy' ? 'bg-green-50 border-green-400' :
                   'bg-gray-50 border-gray-400'
                 ]">
              <div class="flex items-start">
                <span :class="[
                  'mr-3 mt-1',
                  note.type === 'info' ? 'text-blue-500' :
                  note.type === 'warning' ? 'text-yellow-500' :
                  note.type === 'remedy' ? 'text-green-500' :
                  'text-gray-500'
                ]">
                  {{ note.type === 'info' ? '‚ÑπÔ∏è' : 
                     note.type === 'warning' ? '‚ö†Ô∏è' : 
                     note.type === 'remedy' ? 'üíä' : 'üìù' }}
                </span>
                <div class="flex-1">
                  <h4 :class="[
                    'font-semibold mb-2',
                    note.type === 'info' ? 'text-blue-800' :
                    note.type === 'warning' ? 'text-yellow-800' :
                    note.type === 'remedy' ? 'text-green-800' :
                    'text-gray-800'
                  ]">
                    {{ note.title }}
                    <span v-if="note.starCount" class="text-sm font-normal opacity-75">({{ note.starCount }} c·∫∑p)</span>
                  </h4>
                  <p class="text-gray-700 text-sm leading-relaxed">{{ note.content }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <Footer />
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue';
import { useRouter } from 'vue-router';
import Header from '@/components/layout/Header.vue';
import Footer from '@/components/layout/Footer.vue';
import { UniversalAnalysisEngine } from '@/utils/analysisEngine.js';

const router = useRouter();

const cccd = ref('');
const cccdError = ref('');
const analysisResults = ref(null);
const loading = ref(false);
const displayAnalysis = ref(null);

const validateCCCD = () => {
    cccdError.value = '';
    const cccdValue = cccd.value.trim();
    const isValid = /^\d{12}$/.test(cccdValue);
    if (!isValid) cccdError.value = 'S·ªë CCCD ph·∫£i l√† 12 ch·ªØ s·ªë.';
    return isValid;
};

const analyzeCCCD = async () => {
  if (!validateCCCD()) {
    return;
  }

  loading.value = true;
  analysisResults.value = null; 
  displayAnalysis.value = null;

  try {
    // S·ª≠ d·ª•ng logic ph√¢n t√≠ch m·ªõi t·ª´ UniversalAnalysisEngine
    const result = UniversalAnalysisEngine.analyze(cccd.value, 'cccd');

    if (result.error) {
      throw new Error(result.error);
    }

    displayAnalysis.value = result;
    
    // Scroll to results after loading
    setTimeout(() => {
      const resultsElement = document.getElementById('analysis-results');
      if (resultsElement) {
        resultsElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 100);
  } catch (error) {
      cccdError.value = error.message || 'C√≥ l·ªói x·∫£y ra khi ph√¢n t√≠ch';
  } finally {
    loading.value = false;
  }
}

// Navigation method
const navigateToLogin = () => {
  router.push({ name: 'login' })
}

// Helper methods for score display
const getScoreColor = (score) => {
  if (score >= 80) return 'border-green-500 text-green-600';
  if (score >= 60) return 'border-blue-500 text-blue-600';
  if (score >= 40) return 'border-yellow-500 text-yellow-600';
  if (score >= 20) return 'border-orange-500 text-orange-600';
  return 'border-red-500 text-red-600';
};

const getScoreLevel = (score) => {
  if (score >= 80) return "Xu·∫•t S·∫Øc";
  if (score >= 60) return "T·ªët";
  if (score >= 40) return "Trung B√¨nh";
  if (score >= 20) return "K√©m";
  return "R·∫•t K√©m";
};
</script>

<style scoped>
/* C√°c style b·ªï sung n·∫øu c·∫ßn */
.text-primary {
  color: var(--primary-color, #4361ee);
}

.hover\:text-primary:hover {
  color: var(--primary-color, #4361ee);
}

.bg-primary {
  background-color: var(--primary-color, #4361ee);
}

.bg-primary-dark {
  background-color: var(--primary-dark, #3a56d4);
}

/* Animation cho dots khi loading */
@keyframes spin {
  to { transform: rotate(360deg); }
}
.animate-spin {
  animation: spin 1s linear infinite;
}
</style>